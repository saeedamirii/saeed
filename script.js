/* فایل: script.js (نسخه نهایی با بانک لغات داخلی) */

document.addEventListener('DOMContentLoaded', () => {
    // =========================================================
    // ### بانک لغات آفلاین و غنی‌شده ###
    // این لیست اکنون بخشی از فایل اصلی جاوااسکریپت است.
    // =========================================================
        // =========================================================
    // ### بانک لغات عظیم، نهایی و باکیفیت ###
    // =========================================================
    const WORD_BANK = {
        4: [
            "آباد", "آتش", "آخر", "آرام", "آرزو", "آزاد", "آسیب", "آچار", "آگهی", "آینه", "ابرو", "اجاق", "ادب", "ادعا",
            "اذان", "ارده", "اسب", "اسم", "اشک", "اصل", "اعدا", "اغلب", "امید", "انتها", "انشا", "ایده", "ایست", "ایمن",
            "بابا", "باطن", "باور", "ببر", "بچه", "برج", "برق", "برگ", "بغل", "بلند", "بمب", "بنا", "بنز", "بند",
            "بوق", "بوم", "بیان", "بید", "بیمه", "پارو", "پاسخ", "پاک", "پتو", "پدر", "پسر", "پشه", "پشم", "پمپ",
            "پنبه", "پهن", "پیاز", "پیک", "پیل", "تاب", "تاج", "تار", "تازه", "تخت", "تخم", "ترس", "ترک", "ترمز",
            "تست", "تلفن", "تمبر", "تنبل", "تنگ", "توپ", "تپه", "تیر", "تیز", "تیغ", "ثبت", "جاده", "جارو", "جشن",
            "جعبه", "جفت", "جنگ", "جواب", "جوجه", "جوش", "چادر", "چاقو", "چاه", "چپ", "چتر", "چرب", "چرخ", "چرم",
            "چسب", "چشم", "چکش", "حجم", "حرف", "حسود", "حنا", "حوض", "حوله", "خار", "خاک", "خال", "خامه", "خبر",
            "خرج", "خرس", "خشک", "خط", "خلق", "خواب", "خوب", "خون", "خیار", "خیس", "خیمه", "داد", "دارو", "دبی",
            "درب", "درد", "درس", "درشت", "دره", "دریا", "دزد", "دست", "دسر", "دعا", "دفتر", "دقت", "دکل", "دکمه",
            "دل", "دلار", "دنده", "دنیا", "دوغ", "دوش", "ذره", "ذوب", "رانت", "راه", "رخت", "رشد", "رعد", "رنگ",
            "روغن", "ریال", "ریسمان", "ریش", "ریه", "زاد", "زانو", "زبان", "زبر", "زخم", "زرد", "زرشک", "زعفران",
            "زشت", "زمان", "زمین", "زنبور", "زنگ", "زود", "زور", "زیتون", "زین", "ژاپن", "ژله", "ژاکت", "ساد",
            "ساده", "ساز", "ساق", "ساقه", "سال", "سالم", "سامان", "سایه", "سبد", "سبز", "سبزی", "سحر", "سر",
            "سرد", "سرفه", "سوسک", "سوزن", "سکه", "سگ", "سنگ", "سهم", "سیاه", "سیب", "سیر", "سیل", "سیم", "سینی",
            "شادی", "شال", "شام", "شانه", "شاه", "شب", "شتاب", "شتر", "شربت", "شرط", "شروع", "شست", "شعر",
            "شغل", "شکل", "شمال", "شمع", "شنا", "شن", "شور", "شوک", "شهاب", "شهر", "شومینه", "شیر", "شیشه",
            "شیطان", "شیب", "شیپور", "صبر", "صبح", "صدا", "صدف", "صف", "صفحه", "صمغ", "صندل", "صابون", "ضامن",
            "ضرب", "ضعف", "ضرر", "ضلع", "طبل", "طرح", "طعم", "طلا", "طول", "طوطی", "ظرف", "ظهر", "عاج", "عادت",
            "عادل", "عاقل", "عکس", "عسل", "عصر", "عطر", "عقاب", "عقرب", "علم", "عمه", "عمیق", "عینک", "غار",

            "غرب", "غذا", "غزل", "غول", "غم", "فال", "فکر", "فلفل", "فنر", "فیل", "فیلم", "قاب", "قارچ", "قبر",
            "قدر", "قرض", "قرمز", "قشر", "قفل", "قفس", "قله", "قلم", "قند", "قهر", "قیمت", "کابل", "کادو", "کار",
            "کارد", "کارت", "کارمند", "کاسه", "کاش", "کاغذ", "کبوتر", "کتاب", "کتری", "کچل", "کدو", "کرج", "کرسی",
            "کره", "کف", "کفش", "کلاس", "کلید", "کمد", "کمک", "کود", "کودک", "کور", "کوه", "کیسه", "کیف", "کیل",
            "گاو", "گچ", "گدا", "گرد", "گردن", "گرگ", "گرم", "گروه", "گز", "گل", "گلیم", "گلو", "گندم", "گوش",
            "گوجه", "گیلاس", "لاب", "لب", "لبه", "لجباز", "لحاف", "لذت", "لرز", "لغت", "لک", "لکه", "لمس", "لنگ",
            "لوگو", "لوله", "لیز", "مات", "ماست", "ماشین", "ماه", "ماهی", "مبل", "متن", "مثل", "مجلس", "محل",
            "مخ", "مدرک", "مد", "مداد", "مرз", "مرغ", "مرگ", "مرکز", "مزه", "مزد", "مشت", "مصر", "مغز", "مفت",
            "ملخ", "ملکه", "من", "موج", "مور", "موش", "موز", "موم", "مه", "مهر", "مهلت", "مهم", "میخ", "میز",
            "میش", "میوه", "ناب", "ناز", "نام", "نان", "نرم", "نصف", "نفس", "نفت", "نقد", "نقش", "نمره", "نوع",
            "نور", "نوش", "نوک", "نیاز", "نیک", "نیم", "نی", "واگن", "وام", "وجه", "وزن", "وطن", "وقت", "هتل",
            "هدف", "هرم", "هلو", "هوا", "هویج", "هیچ", "یاد", "یار", "یاس", "یخ"
        ],
        5: [
            "آبادان", "آبشار", "آبمیوه", "آجر", "آخرین", "آرامش", "آرزو", "آرمان", "آزمون", "آژانس", "آسان", "آسمان",
            "آسیاب", "آشپز", "آشنا", "آفتاب", "آلبوم", "آلمان", "آلوده", "آواره", "آواز", "آویز", "آینه", "ابریشم",
            "اتاق", "اتفاق", "اثر", "اجتماع", "اجرا", "اداره", "ادامه", "ادبیات", "اراده", "ارزان", "ارزش", "اسب",
            "اسباب", "اسپاگتی", "استاد", "استخر", "اسکی", "اسیر", "اشاره", "اشکال", "اصفهان", "اصل", "اصلی", "اعتماد",
            "اعزام", "افسوس", "افسر", "افکار", "اقامت", "اقلیم", "اکسیژن", "اکنون", "الماس", "النگو", "امتحان", "امروز",
            "امضا", "امکان", "امنیت", "امیدوار", "انتخاب", "انجام", "اندازه", "اندوه", "انسان", "انضباط", "انعام",
            "انقلاب", "انگیزه", "اهواز", "اول", "ایران", "ایراد", "ایستگاه", "ایمان", "اینجا", "بابونه", "بادام",
            "بادکنک", "باران", "باربر", "باریک", "بازار", "بازرس", "بازیگر", "باغبان", "بافت", "باقلا", "باکره",
            "بالا", "بالش", "بانک", "باهوش", "ببر", "بحران", "بخار", "بخاری", "بخش", "بخشنده", "بد", "بدبخت", "بدن",
            "بذر", "برادر", "برج", "برتر", "برخورد", "برده", "برنده", "برنز", "برنامه", "بزرگ", "بز", "بشقاب", "بغل",
            "بلال", "بلدرچین", "بلور", "بلیت", "بمب", "بنا", "بندر", "بنفش", "بنیاد", "بوی", "بهار", "بهتر", "بهشت",
            "بوفه", "بوقلمون", "بیمار", "بینا", "پادشاه", "پارچه", "پاسخ", "پاشنه", "پاکت", "پایان", "پاییز", "پدر",
            "پرچم", "پرده", "پرستار", "پرستو", "پرسش", "پروانه", "پرواز", "پزشک", "پسر", "پسته", "پل", "پلنگ", "پلیس",
            "پناه", "پنبه", "پنج", "پنجره", "پودر", "پونه", "پهلوان", "پیاده", "پیاز", "پیام", "پیچ", "پیچک", "پیر",
            "پیرزن", "پیرمرد", "پیره", "پیک", "پیکان", "پیمان", "تابستان", "تاریخ", "تاکسی", "تایر", "تجربه",
            "تحصیل", "تخت", "تخته", "تخفیف", "تخم", "تراش", "تربچه", "ترجمه", "ترس", "ترشی", "تلاش", "تلفن", "تماشا",
            "تمیز", "تنها", "تنور", "توپ", "توت", "توضیح", "توفان", "تپه", "تک", "تکلیف", "تکه", "تگرگ", "جایزه", "جشن",
            "جغد", "جلبک", "جمع", "جمعه", "جنگل", "جهان", "جهت", "جیب", "جیغ", "حباب", "حجاب", "حدس", "حرارت", "حراج",
            "حریر", "حساب", "حسود", "حقوق", "حلقه", "حمام", "حمله", "حیات", "حیوان", "خادم", "خارج", "خارپشت", "خازن",
            "خاطره", "خاک", "خال", "خامه", "خاموش", "خانه", "خانواده", "خبر", "خدمت", "خراب", "خرید", "خز", "خزنده",
            "خسیس", "خشک", "خط", "خطا", "خطر", "خلیج", "خلبان", "خمیر", "خواب", "خواهش", "خواننده", "خوب", "خود",
            "خودکار", "خون", "خیابان", "خیال", "خیمه", "دادگاه", "دارو", "داستان", "داغ", "دانش", "دبیر", "دختر", "در",
            "درخت", "درد", "درس", "درمان", "دروازه", "دریا", "دزد", "دست", "دسته", "دشمن", "دعا", "دفاع", "دفتر", "دکمه",
            "دکل", "دل", "دلیل", "دما", "دماغ", "دندان", "دنیا", "دنده", "دو", "دوات", "دوچرخه", "دود", "دور", "دوربین",

            "دوره", "دوست", "دوش", "دولت", "ده", "دهان", "دهکده", "دی", "دیوار", "دیگر", "ذغال", "ذرت", "ذوق", "رادیو",
            "راز", "راست", "راننده", "راه", "راهرو", "رخت", "رشد", "رشته", "رطوبت", "رفتار", "رقیب", "رم", "رمان", "رنگ",
            "رو", "روان", "رود", "روز", "روستا", "روشن", "روغن", "ریاضی", "ریشه", "زابل", "زانو", "زبان", "زنبور", "زنجیر",
            "زندان", "زنده", "زندگی", "زنگ", "زود", "زور", "زوزه", "زیبا", "زیر", "زیره", "زیتون", "ژاکت", "ژاله",
        ],
        6: [
            "آرامگاه", "آرایشگر", "آرزو", "آرمان", "آزمایش", "آسایش", "آسمان", "آسیب", "آشپز", "آشغال", "آشنا",
            "آغاز", "آفتابه", "آگهی", "آلودگی", "آواره", "آویز", "آینده", "ابریشم", "اتاق", "اتوبوس", "اتومبیل", "اجازه",
            "اجتماع", "احترام", "احساس", "احمق", "اخبار", "اخطار", "اداره", "ادامه", "ادبیات", "اردیبهشت", "ارسال",
            "ارکیده", "ارمنستان", "اروپا", "اسب", "اسباب", "اسپاگتی", "استاد", "استخوان", "استراحت", "استکان",
            "اسفناج", "اسلام", "اسلحه", "اشتباه", "اصفهان", "اصل", "اصلی", "اطراف", "اطلاع", "اعداد", "اعتقاد", "اعصاب",
            "اعماق", "افسانه", "افسر", "افغانستان", "افکار", "اقامت", "اقتصاد", "اقیانوس", "اکتبر", "اکسیژن", "الکتریک",
            "الماس", "النگو", "امارات", "امپراتور", "امتحان", "امداد", "امروز", "امضا", "امکان", "امنیت", "امید",
            "انتخاب", "انتظار", "انجام", "اندازه", "اندام", "اندیشه", "انسان", "انشا", "انضباط", "انعکاس", "انفجار",
            "انقلاب", "انگشت", "انگشتر", "انگلیس", "انگور", "اهواز", "اول", "ایران", "ایرانی", "ایراد", "ایستگاه",
            "ایمان", "اینترنت", "بابونه", "بادام", "بادبادک", "بادمجان", "باران", "بارانی", "باربر", "بارسلون", "باری",
            "بازار", "بازارچه", "بازتاب", "بازجو", "بازرس", "بازدید", "بازی", "بازیگر", "باغ", "باغچه", "باغبان",
            "بافتنی", "باقر", "باقلا", "باک", "بالا", "بالگرد", "بالن", "باله", "بام", "بامیه", "بانک", "بانو", "ببر",
            "بحران", "بخار", "بخاری", "بخش", "بخشنده", "بد", "بدبخت", "بدبین", "بدتر", "بدجنس", "بدشانس", "بدل",
            "بدلیجات", "بدن", "بذر", "برادر", "برادرزاده", "براده", "برج", "برتر", "برتری", "برجسته", "برخورد",
            "برده", "بررسی", "برعکس", "برق", "برگ", "برگزار", "برگشت", "برنامه", "برنج", "برنده", "برنز", "بره", "برهنه",
            "بزرگ", "بزرگترین", "بزرگراه", "بز", "بزاق", "بستنی", "بسته", "بستر", "بسیار", "بشقاب", "بغل", "بقیه", "بلا",
            "بلال", "بلدرچین", "بلند", "بلندگو", "بلور", "بلوک", "بلیت", "بمب", "بنا", "بنادر", "بنفش", "بنگاه", "بنیاد",
            "بنیانگذار", "بو", "بورس", "بوسه", "بوفه", "بوق", "بوقلمون", "بوکس", "بوی", "به", "بهار", "بهتر", "بهترین",
            "بهشت", "بی", "بیا", "بیابان", "بیات", "بیان", "ببر", "بچه", "بد", "بدبخت", "بدبین", "بدتر", "بدجنس",
            "بدشانس", "بدل", "بدلیجات", "بدن", "بذر", "برادر", "برادرزاده", "براده", "برج", "برتر", "برتری", "برجسته",
            "برخورد", "برده", "بررسی", "برعکس", "برق", "برگ", "برگزار", "برگشت", "برنامه", "برنج", "برنده", "برنز", "بره",
            "برهنه", "بزرگ", "بزرگترین", "بزرگراه", "بز", "بزاق", "بستنی", "بسته", "بستر", "بسیار", "بشقاب", "بغل", "بقیه",
            "بلا", "بلال", "بلدرچین", "بلند", "بلندگو", "بلور", "بلوک", "بلیت", "بمب", "بنا", "بنادر", "بنفش", "بنگاه",
            "بنیاد", "بنیانگذار", "بو", "بورس", "بوسه", "بوفه", "بوق", "بوقلمون", "بوکس", "بوی", "به", "بهار", "بهتر", "بهترین"
        ]
    };
    
    // بقیه کدهای جاوااسکریپت شما بدون هیچ تغییری در اینجا قرار می‌گیرد...
    // ...
});

    

    // --- انتخاب عناصر ---
    const gridContainer = document.getElementById('grid-container');
    const keyboardContainer = document.getElementById('keyboard-container');
    const difficultySelector = document.getElementById('difficulty-selector');
    const toast = document.getElementById('toast');

    // --- وضعیت بازی ---
    let wordLength = 5;
    let secretWord = '';
    let currentRow = 0;
    let currentCol = 0;
    let guesses = [];
    
    // --- تعریف کیبورد ---
    const keys = [
        ["ض", "ص", "ث", "ق", "ف", "غ", "ع", "ه", "خ", "ح", "ج"],
        ["چ", "ش", "س", "ی", "ب", "ل", "ا", "ت", "ن", "م", "ک"],
        ["گ", "ظ", "ط", "ز", "ر", "ذ", "د", "پ", "و", "ENTER"],
        ["ژ", "Backspace"]
    ];

    const normalizeWord = (word) => {
        if (!word) return '';
        return word
            .trim()
            .replace(/آ/g, 'ا')
            .replace(/ي|ئ/g, 'ی')
            .replace(/ك/g, 'ک');
    };

    const startGame = () => {
        gridContainer.innerHTML = '';
        keyboardContainer.innerHTML = '';
        currentRow = 0;
        currentCol = 0;
        guesses = Array(6).fill(null).map(() => Array(wordLength).fill(''));
        
        const wordList = WORD_BANK[wordLength];
        secretWord = normalizeWord(wordList[Math.floor(Math.random() * wordList.length)]);
        console.log("کلمه رمز (برای تست):", secretWord);

        for (let i = 0; i < 6; i++) {
            const row = document.createElement('div');
            row.className = 'grid-row';
            row.style.gridTemplateColumns = `repeat(${wordLength}, 1fr)`;
            for (let j = 0; j < wordLength; j++) {
                const tile = document.createElement('div');
                tile.className = 'grid-tile';
                tile.innerHTML = `<div class="front"></div><div class="back"></div>`;
                row.appendChild(tile);
            }
            gridContainer.appendChild(row);
        }

        keys.forEach(rowKeys => {
            const row = document.createElement('div');
            row.className = 'keyboard-row';
            rowKeys.forEach(key => {
                const button = document.createElement('button');
                button.className = 'key';
                button.textContent = key;
                if (key.length > 1) button.classList.add('large');
                button.addEventListener('click', () => handleKeyPress(key));
                row.appendChild(button);
            });
            keyboardContainer.appendChild(row);
        });
    };

    const handleKeyPress = (key) => {
        if (key === 'ENTER') {
            if (currentCol === wordLength) submitGuess();
            return;
        }
        if (key === 'Backspace') {
            if (currentCol > 0) {
                currentCol--;
                const tile = gridContainer.children[currentRow].children[currentCol];
                tile.querySelector('.front').textContent = '';
                tile.classList.remove('filled');
            }
            return;
        }
        if (currentCol < wordLength) {
            const tile = gridContainer.children[currentRow].children[currentCol];
            tile.querySelector('.front').textContent = key;
            tile.classList.add('filled');
            guesses[currentRow][currentCol] = key;
            currentCol++;
        }
    };
    
    const submitGuess = () => {
        const guess = normalizeWord(guesses[currentRow].join(''));
        const normalizedBank = WORD_BANK[wordLength].map(normalizeWord);

        if (!normalizedBank.includes(guess)) {
            showToast("کلمه در لیست نیست!");
            return;
        }

        const tiles = gridContainer.children[currentRow].children;
        const feedback = checkGuess(guess);
        let flipDelay = 0;

        for (let i = 0; i < wordLength; i++) {
            setTimeout(() => {
                tiles[i].classList.add('flip');
                tiles[i].querySelector('.back').textContent = tiles[i].querySelector('.front').textContent;
                tiles[i].classList.add(feedback[i]);
            }, flipDelay);
            flipDelay += 300;
        }
        
        setTimeout(() => updateKeyboard(guess, feedback), flipDelay);
        
        if (guess === secretWord) {
            setTimeout(() => showToast("عالی بود! برنده شدی!"), flipDelay + 500);
        } else {
            currentRow++;
            currentCol = 0;
            if (currentRow === 6) {
                setTimeout(() => showToast(`باختی! کلمه صحیح: ${secretWord}`), flipDelay + 500);
            }
        }
    };
    
    const checkGuess = (guess) => {
        const feedback = Array(wordLength).fill('absent');
        const secretWordChars = secretWord.split('');
        const guessChars = guess.split('');
        
        for (let i = 0; i < wordLength; i++) {
            if (guessChars[i] === secretWordChars[i]) {
                feedback[i] = 'correct';
                secretWordChars[i] = null;
            }
        }
        
        for (let i = 0; i < wordLength; i++) {
            if (feedback[i] !== 'correct') {
                const charIndex = secretWordChars.indexOf(guessChars[i]);
                if (charIndex > -1) {
                    feedback[i] = 'present';
                    secretWordChars[charIndex] = null;
                }
            }
        }
        return feedback;
    };
    
    const updateKeyboard = (guess, feedback) => {
        for (let i = 0; i < guess.length; i++) {
            const keyElement = [...document.querySelectorAll('.key')].find(k => k.textContent === guess[i]);
            if (!keyElement) continue;

            const currentStatus = keyElement.classList;
            const newStatus = feedback[i];

            if (currentStatus.contains('correct')) continue;
            if (currentStatus.contains('present') && newStatus !== 'correct') continue;
            
            keyElement.classList.remove('present', 'absent');
            keyElement.classList.add(newStatus);
        }
    };

    const showToast = (message) => {
        toast.textContent = message;
        toast.classList.add('show');
        setTimeout(() => toast.classList.remove('show'), 2000);
    };

    difficultySelector.addEventListener('click', (e) => {
        if (e.target.tagName !== 'BUTTON') return;
        
        wordLength = parseInt(e.target.dataset.length);
        document.querySelectorAll('.difficulty-btn').forEach(btn => btn.classList.remove('active'));
        e.target.classList.add('active');
        startGame();
    });

    startGame();
});
